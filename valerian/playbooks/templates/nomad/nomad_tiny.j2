datacenter = "{{ datacenter }}"
data_dir  = "/opt/nomad"
bind_addr = "0.0.0.0"
name = "{{ name }}"
advertise {
  # Defaults to the first private IP address.
  http = "{{ ansible_host }}"
  rpc  = "{{ ansible_host }}"
  serf = "{{ ansible_host }}"
}
log_file = "/opt/nomad/logs/"
log_level = "INFO"
log_rotate_duration = "24h"
log_rotate_max_files = 10
log_rotate_bytes = 10485760

enable_debug = true

server {
  enabled          = true
  bootstrap_expect = 1

  job_gc_interval = "5m"
  job_gc_threshold = "1440m"
  eval_gc_threshold = "1440m"
  deployment_gc_threshold = "1440m"
  node_gc_threshold = "1440m"

  default_scheduler_config {
    scheduler_algorithm             = "binpack"
    #memory_oversubscription_enabled = true
    #reject_job_registration         = false
    #pause_eval_broker               = false # New in Nomad 1.3.2

    preemption_config {
      batch_scheduler_enabled    = true
      system_scheduler_enabled   = true
      service_scheduler_enabled  = true
      #sysbatch_scheduler_enabled = true # New in Nomad 1.2
    }
  }

}

client {
  enabled       = true
  meta {
   DFS = "/v"
   name = "{{ affinity_name }}"
  }

  reserved {
    cpu = 5000
    memory = 6500
  }

  options {
    docker.volumes.enabled = true
  }

  chroot_env {
    "/etc/resolv.conf" = "/etc/resolv.conf",
	  "/bin" = "/bin",
	  "/etc/alternatives/nc" = "/etc/alternatives/nc",
    "/lib" = "/lib",
    "/lib32" = "/lib32",
    "/lib64" = "/lib64",
    "/run/resolvconf" = "/run/resolvconf",
    "/sbin" = "/sbin",
    "/usr" = "/usr",
	  "/etc/passwd" = "/etc/passwd"
  }   
}

plugin "raw_exec" {
  config {
    enabled = true
  }
}


consul {
  address = "127.0.0.1:8500"
}

